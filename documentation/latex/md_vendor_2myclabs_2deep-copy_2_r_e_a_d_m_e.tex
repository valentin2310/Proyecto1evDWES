\chapter{Deep\+Copy}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e}{}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e}\index{DeepCopy@{DeepCopy}}
\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1251}%
\Hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1251}%
 \doxylink{namespace_deep_copy}{Deep\+Copy} helps you create deep copies (clones) of your objects. It is designed to handle cycles in the association graph.

\href{https://packagist.org/packages/myclabs/deep-copy}{\texttt{ }} \href{https://github.com/myclabs/DeepCopy/actions}{\texttt{ }}\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1252}{}\doxysection{\texorpdfstring{Table of Contents}{Table of Contents}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1252}

\begin{DoxyEnumerate}
\item How
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Why
\begin{DoxyEnumerate}
\item Using simply \`{}clone\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Overriding \`{}\+\_\+\+\_\+clone()\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item With \`{}\+Deep\+Copy\`{}
\end{DoxyEnumerate}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item How it works
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Going further
\begin{DoxyEnumerate}
\item Matchers
\begin{DoxyEnumerate}
\item Property name
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Specific property
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Type
\end{DoxyEnumerate}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Filters
\begin{DoxyEnumerate}
\item \`{}\+Set\+Null\+Filter\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \`{}\+Keep\+Filter\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \`{}\+Doctrine\+Collection\+Filter\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \`{}\+Doctrine\+Empty\+Collection\+Filter\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \`{}\+Doctrine\+Proxy\+Filter\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \`{}\+Replace\+Filter\`{}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item \`{}\+Shallow\+Copy\+Filter\`{}
\end{DoxyEnumerate}
\end{DoxyEnumerate}
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Edge cases
\end{DoxyEnumerate}
\begin{DoxyEnumerate}
\item Contributing
\begin{DoxyEnumerate}
\item \doxylink{dir_59425e443f801f1f2fd8bbe4959a3ccf}{Tests}
\end{DoxyEnumerate}
\end{DoxyEnumerate}\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1253}{}\doxysection{\texorpdfstring{How?}{How?}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1253}
Install with \doxylink{namespace_composer}{Composer}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{composer\ require\ myclabs/deep-\/copy}

\end{DoxyCode}


Use it\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$myCopy\ =\ \$copier-\/>copy(\$myObject);}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1254}{}\doxysection{\texorpdfstring{Why?}{Why?}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1254}

\begin{DoxyItemize}
\item How do you create copies of your objects?
\end{DoxyItemize}


\begin{DoxyCode}{0}
\DoxyCodeLine{\$myCopy\ =\ \mbox{\hyperlink{namespace_carbon_1_1_traits_a30fb1fe83217b873d8e474b88f258ae7}{clone}}\ \$myObject;}

\end{DoxyCode}



\begin{DoxyItemize}
\item How do you create {\bfseries{deep}} copies of your objects (i.\+e. copying also all the objects referenced in the properties)?
\end{DoxyItemize}

You use \href{http://www.php.net/manual/en/language.oop5.cloning.php\#object.clone}{\texttt{ {\ttfamily \+\_\+\+\_\+clone()}}} and implement the behavior yourself.


\begin{DoxyItemize}
\item But how do you handle {\bfseries{cycles}} in the association graph?
\end{DoxyItemize}

Now you\textquotesingle{}re in for a big mess \+:(

\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1255}{}\doxysubsection{\texorpdfstring{Using simply $<$tt$>$clone$<$/tt$>$}{Using simply <tt>clone</tt>}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1255}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1256}{}\doxysubsection{\texorpdfstring{Overriding $<$tt$>$\+\_\+\+\_\+clone()$<$/tt$>$}{Overriding <tt>\_\_clone()</tt>}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1256}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1257}{}\doxysubsection{\texorpdfstring{With $<$tt$>$\+Deep\+Copy$<$/tt$>$}{With <tt>DeepCopy</tt>}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1257}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1258}{}\doxysection{\texorpdfstring{How it works}{How it works}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1258}
\doxylink{namespace_deep_copy}{Deep\+Copy} recursively traverses all the object\textquotesingle{}s properties and clones them. To avoid cloning the same object twice it keeps a hash map of all instances and thus preserves the object graph.

To use it\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \textcolor{keyword}{function}\ DeepCopy\(\backslash\)deep\_copy;}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ deep\_copy(\$var);}

\end{DoxyCode}


Alternatively, you can create your own {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}} instance to configure it differently for example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}(\textcolor{keyword}{true});}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$var);}

\end{DoxyCode}


You may want to roll your own deep copy function\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{namespace\ }Acme;}
\DoxyCodeLine{}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{function}\ deep\_copy(\$var)}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{static}\ \$copier\ =\ \textcolor{keyword}{null};}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{null}\ ===\ \$copier)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}(\textcolor{keyword}{true});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{return}\ \$copier-\/>copy(\$var);}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1259}{}\doxysection{\texorpdfstring{Going further}{Going further}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1259}
You can add filters to customize the copy process.

The method to add a filter is {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Deep\+Copy\+::add\+Filter(\$filter, \$matcher)}, with {\ttfamily \$filter} implementing {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Filter\textbackslash{}Filter} and {\ttfamily \$matcher} implementing {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Matcher\textbackslash{}Matcher}.

We provide some generic filters and matchers.\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1260}{}\doxysubsection{\texorpdfstring{Matchers}{Matchers}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1260}

\begin{DoxyItemize}
\item {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Matcher} applies on a object attribute.
\item {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Type\+Matcher} applies on any element found in graph, including array elements.
\end{DoxyItemize}\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1261}{}\doxysubsubsection{\texorpdfstring{Property name}{Property name}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1261}
The {\ttfamily Property\+Name\+Matcher} will match a property by its name\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_name_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyNameMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Will\ apply\ a\ filter\ to\ any\ property\ of\ any\ objects\ named\ "{}id"{}}}
\DoxyCodeLine{\$matcher\ =\ \textcolor{keyword}{new}\ PropertyNameMatcher(\textcolor{stringliteral}{'id'});}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1262}{}\doxysubsubsection{\texorpdfstring{Specific property}{Specific property}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1262}
The {\ttfamily Property\+Matcher} will match a specific property of a specific class\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Will\ apply\ a\ filter\ to\ the\ property\ "{}id"{}\ of\ any\ objects\ of\ the\ class\ "{}MyClass"{}}}
\DoxyCodeLine{\$matcher\ =\ \textcolor{keyword}{new}\ PropertyMatcher(\textcolor{stringliteral}{'MyClass'},\ \textcolor{stringliteral}{'id'});}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1263}{}\doxysubsubsection{\texorpdfstring{Type}{Type}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1263}
The {\ttfamily Type\+Matcher} will match any element by its type (instance of a class or any value that could be parameter of \href{http://php.net/manual/en/function.gettype.php}{\texttt{ gettype()}} function)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_type_matcher_1_1_type_matcher}{DeepCopy\(\backslash\)TypeMatcher\(\backslash\)TypeMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ Will\ apply\ a\ filter\ to\ any\ object\ that\ is\ an\ instance\ of\ Doctrine\(\backslash\)Common\(\backslash\)Collections\(\backslash\)Collection}}
\DoxyCodeLine{\$matcher\ =\ \textcolor{keyword}{new}\ TypeMatcher(\textcolor{stringliteral}{'Doctrine\(\backslash\)Common\(\backslash\)Collections\(\backslash\)Collection'});}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1264}{}\doxysubsection{\texorpdfstring{Filters}{Filters}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1264}

\begin{DoxyItemize}
\item {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Filter} applies a transformation to the object attribute matched by {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Matcher}
\item {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Type\+Filter} applies a transformation to any element matched by {\ttfamily \doxylink{namespace_deep_copy}{Deep\+Copy}\textbackslash{}Type\+Matcher}
\end{DoxyItemize}

By design, matching a filter will stop the chain of filters (i.\+e. the next ones will not be applied). Using the (\`{}\+Chainable\+Filter\`{}) won\textquotesingle{}t stop the chain of filters.\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1265}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Set\+Null\+Filter$<$/tt$>$ (filter)}{<tt>SetNullFilter</tt> (filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1265}
Let\textquotesingle{}s say for example that you are copying a database record (or a Doctrine entity), so you want the copy not to have any ID\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_set_null_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)SetNullFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_name_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyNameMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$object\ =\ MyClass::load(123);}
\DoxyCodeLine{echo\ \$object-\/>id;\ \textcolor{comment}{//\ 123}}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ SetNullFilter(),\ \textcolor{keyword}{new}\ PropertyNameMatcher(\textcolor{stringliteral}{'id'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}
\DoxyCodeLine{}
\DoxyCodeLine{echo\ \$copy-\/>id;\ \textcolor{comment}{//\ null}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1266}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Keep\+Filter$<$/tt$>$ (filter)}{<tt>KeepFilter</tt> (filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1266}
If you want a property to remain untouched (for example, an association to an object)\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_keep_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)KeepFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ KeepFilter(),\ \textcolor{keyword}{new}\ PropertyMatcher(\textcolor{stringliteral}{'MyClass'},\ \textcolor{stringliteral}{'category'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}
\DoxyCodeLine{\textcolor{comment}{//\ \$copy-\/>category\ has\ not\ been\ touched}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1267}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Chainable\+Filter$<$/tt$>$ (filter)}{<tt>ChainableFilter</tt> (filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1267}
If you use cloning on proxy classes, you might want to apply two filters for\+:
\begin{DoxyEnumerate}
\item loading the data
\item applying a transformation
\end{DoxyEnumerate}

You can use the {\ttfamily Chainable\+Filter} as a decorator of the proxy loader filter, which won\textquotesingle{}t stop the chain of filters (i.\+e. the next ones may be applied).


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_chainable_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)ChainableFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_doctrine_1_1_doctrine_proxy_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)Doctrine\(\backslash\)DoctrineProxyFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_set_null_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)SetNullFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_doctrine_1_1_doctrine_proxy_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)Doctrine\(\backslash\)DoctrineProxyMatcher}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_name_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyNameMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ ChainableFilter(\textcolor{keyword}{new}\ DoctrineProxyFilter()),\ \textcolor{keyword}{new}\ DoctrineProxyMatcher());}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ SetNullFilter(),\ \textcolor{keyword}{new}\ PropertyNameMatcher(\textcolor{stringliteral}{'id'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}
\DoxyCodeLine{}
\DoxyCodeLine{echo\ \$copy-\/>id;\ \textcolor{comment}{//\ null}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1268}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Doctrine\+Collection\+Filter$<$/tt$>$ (filter)}{<tt>DoctrineCollectionFilter</tt> (filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1268}
If you use Doctrine and want to copy an entity, you will need to use the {\ttfamily Doctrine\+Collection\+Filter}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_doctrine_1_1_doctrine_collection_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)Doctrine\(\backslash\)DoctrineCollectionFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_type_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyTypeMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ DoctrineCollectionFilter(),\ \textcolor{keyword}{new}\ PropertyTypeMatcher(\textcolor{stringliteral}{'Doctrine\(\backslash\)Common\(\backslash\)Collections\(\backslash\)Collection'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1269}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Doctrine\+Empty\+Collection\+Filter$<$/tt$>$ (filter)}{<tt>DoctrineEmptyCollectionFilter</tt> (filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1269}
If you use Doctrine and want to copy an entity who contains a {\ttfamily Collection} that you want to be reset, you can use the {\ttfamily Doctrine\+Empty\+Collection\+Filter}


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_doctrine_1_1_doctrine_empty_collection_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)Doctrine\(\backslash\)DoctrineEmptyCollectionFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ DoctrineEmptyCollectionFilter(),\ \textcolor{keyword}{new}\ PropertyMatcher(\textcolor{stringliteral}{'MyClass'},\ \textcolor{stringliteral}{'myProperty'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ \$copy-\/>myProperty\ will\ return\ an\ empty\ collection}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1270}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Doctrine\+Proxy\+Filter$<$/tt$>$ (filter)}{<tt>DoctrineProxyFilter</tt> (filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1270}
If you use Doctrine and use cloning on lazy loaded entities, you might encounter errors mentioning missing fields on a Doctrine proxy class (...\textbackslash{}\+\_\+\+\_\+\+CG\+\_\+\+\_\+\textbackslash{}\+Proxy). You can use the {\ttfamily Doctrine\+Proxy\+Filter} to load the actual entity behind the Doctrine proxy class. {\bfseries{Make sure, though, to put this as one of your very first filters in the filter chain so that the entity is loaded before other filters are applied!}} We recommend to decorate the {\ttfamily Doctrine\+Proxy\+Filter} with the {\ttfamily Chainable\+Filter} to allow applying other filters to the cloned lazy loaded entities.


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_doctrine_1_1_doctrine_proxy_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)Doctrine\(\backslash\)DoctrineProxyFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_doctrine_1_1_doctrine_proxy_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)Doctrine\(\backslash\)DoctrineProxyMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ ChainableFilter(\textcolor{keyword}{new}\ DoctrineProxyFilter()),\ \textcolor{keyword}{new}\ DoctrineProxyMatcher());}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ \$copy\ should\ now\ contain\ a\ clone\ of\ all\ entities,\ including\ those\ that\ were\ not\ yet\ fully\ loaded.}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1271}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Replace\+Filter$<$/tt$>$ (type filter)}{<tt>ReplaceFilter</tt> (type filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1271}

\begin{DoxyEnumerate}
\item If you want to replace the value of a property\+:
\end{DoxyEnumerate}


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_filter_1_1_replace_filter}{DeepCopy\(\backslash\)Filter\(\backslash\)ReplaceFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_matcher_1_1_property_matcher}{DeepCopy\(\backslash\)Matcher\(\backslash\)PropertyMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$callback\ =\ \textcolor{keyword}{function}\ (\$currentValue)\ \{}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{return}\ \$currentValue\ .\ \textcolor{stringliteral}{'\ (copy)'}}
\DoxyCodeLine{\};}
\DoxyCodeLine{\$copier-\/>addFilter(\textcolor{keyword}{new}\ ReplaceFilter(\$callback),\ \textcolor{keyword}{new}\ PropertyMatcher(\textcolor{stringliteral}{'MyClass'},\ \textcolor{stringliteral}{'title'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy(\$object);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ \$copy-\/>title\ will\ contain\ the\ data\ returned\ by\ the\ callback,\ e.g.\ 'The\ title\ (copy)'}}

\end{DoxyCode}



\begin{DoxyEnumerate}
\item If you want to replace whole element\+:
\end{DoxyEnumerate}


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_type_filter_1_1_replace_filter}{DeepCopy\(\backslash\)TypeFilter\(\backslash\)ReplaceFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_type_matcher_1_1_type_matcher}{DeepCopy\(\backslash\)TypeMatcher\(\backslash\)TypeMatcher}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$copier\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$callback\ =\ \textcolor{keyword}{function}\ (MyClass\ \$myClass)\ \{}
\DoxyCodeLine{\ \ \textcolor{keywordflow}{return}\ get\_class(\$myClass);}
\DoxyCodeLine{\};}
\DoxyCodeLine{\$copier-\/>addTypeFilter(\textcolor{keyword}{new}\ ReplaceFilter(\$callback),\ \textcolor{keyword}{new}\ TypeMatcher(\textcolor{stringliteral}{'MyClass'}));}
\DoxyCodeLine{}
\DoxyCodeLine{\$copy\ =\ \$copier-\/>copy([\textcolor{keyword}{new}\ MyClass,\ \textcolor{stringliteral}{'some\ string'},\ \textcolor{keyword}{new}\ MyClass]);}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ \$copy\ will\ contain\ ['MyClass',\ 'some\ string',\ 'MyClass']}}

\end{DoxyCode}


The {\ttfamily \$callback} parameter of the {\ttfamily Replace\+Filter} constructor accepts any PHP callable.\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1272}{}\doxysubsubsection{\texorpdfstring{$<$tt$>$\+Shallow\+Copy\+Filter$<$/tt$>$ (type filter)}{<tt>ShallowCopyFilter</tt> (type filter)}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1272}
Stop {\itshape \doxylink{namespace_deep_copy}{Deep\+Copy}} from recursively copying element, using standard {\ttfamily clone} instead\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_deep_copy}{DeepCopy\(\backslash\)DeepCopy}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_type_filter_1_1_shallow_copy_filter}{DeepCopy\(\backslash\)TypeFilter\(\backslash\)ShallowCopyFilter}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_deep_copy_1_1_type_matcher_1_1_type_matcher}{DeepCopy\(\backslash\)TypeMatcher\(\backslash\)TypeMatcher}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{namespace_mockery}{Mockery}}\ as\ m;}
\DoxyCodeLine{}
\DoxyCodeLine{\$this-\/>deepCopy\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{namespace_deep_copy}{DeepCopy}}();}
\DoxyCodeLine{\$this-\/>deepCopy-\/>addTypeFilter(}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{new}\ ShallowCopyFilter,}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{new}\ TypeMatcher(m\(\backslash\)MockInterface::class)}
\DoxyCodeLine{);}
\DoxyCodeLine{}
\DoxyCodeLine{\$myServiceWithMocks\ =\ \textcolor{keyword}{new}\ MyService(m::mock(MyDependency1::class),\ m::mock(MyDependency2::class));}
\DoxyCodeLine{\textcolor{comment}{//\ All\ mocks\ will\ be\ just\ cloned,\ not\ deep\ copied}}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1273}{}\doxysection{\texorpdfstring{Edge cases}{Edge cases}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1273}
The following structures cannot be deep-\/copied with PHP Reflection. As a result they are shallow cloned and filters are not applied. There is two ways for you to handle them\+:


\begin{DoxyItemize}
\item Implement your own {\ttfamily \+\_\+\+\_\+clone()} method
\item Use a filter with a type matcher
\end{DoxyItemize}\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1274}{}\doxysection{\texorpdfstring{Contributing}{Contributing}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1274}
\doxylink{namespace_deep_copy}{Deep\+Copy} is distributed under the MIT license.\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1275}{}\doxysubsection{\texorpdfstring{Tests}{Tests}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1275}
Running the tests is simple\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{vendor/bin/phpunit}

\end{DoxyCode}
\hypertarget{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1276}{}\doxysubsection{\texorpdfstring{Support}{Support}}\label{md_vendor_2myclabs_2deep-copy_2_r_e_a_d_m_e_autotoc_md1276}
Get professional support via \href{https://tidelift.com/subscription/pkg/packagist-myclabs-deep-copy?utm_source=packagist-myclabs-deep-copy&utm_medium=referral&utm_campaign=readme}{\texttt{ the Tidelift Subscription}}. 