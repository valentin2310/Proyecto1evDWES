\doxysection{Authenticate\+Session.\+php}
\hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source}{}\label{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source}\index{vendor/laravel/sanctum/src/Http/Middleware/AuthenticateSession.php@{vendor/laravel/sanctum/src/Http/Middleware/AuthenticateSession.php}}
\mbox{\hyperlink{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00001}00001\ <?php}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00003}\mbox{\hyperlink{namespace_laravel_1_1_sanctum_1_1_http_1_1_middleware}{00003}}\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_laravel_1_1_sanctum_1_1_http_1_1_middleware}{Laravel\(\backslash\)Sanctum\(\backslash\)Http\(\backslash\)Middleware}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00004}00004\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00005}00005\ use\ Closure;}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00006}00006\ use\ \mbox{\hyperlink{class_illuminate_1_1_auth_1_1_authentication_exception}{Illuminate\(\backslash\)Auth\(\backslash\)AuthenticationException}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00007}00007\ use\ \mbox{\hyperlink{class_illuminate_1_1_auth_1_1_session_guard}{Illuminate\(\backslash\)Auth\(\backslash\)SessionGuard}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00008}00008\ use\ \mbox{\hyperlink{interface_illuminate_1_1_contracts_1_1_auth_1_1_factory}{Illuminate\(\backslash\)Contracts\(\backslash\)Auth\(\backslash\)Factory}}\ as\ AuthFactory;}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00009}00009\ use\ \mbox{\hyperlink{class_illuminate_1_1_http_1_1_request}{Illuminate\(\backslash\)Http\(\backslash\)Request}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00010}00010\ use\ \mbox{\hyperlink{class_illuminate_1_1_support_1_1_arr}{Illuminate\(\backslash\)Support\(\backslash\)Arr}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00011}00011\ use\ \mbox{\hyperlink{class_illuminate_1_1_support_1_1_collection}{Illuminate\(\backslash\)Support\(\backslash\)Collection}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00012}00012\ use\ \mbox{\hyperlink{class_symfony_1_1_component_1_1_http_foundation_1_1_response}{Symfony\(\backslash\)Component\(\backslash\)HttpFoundation\(\backslash\)Response}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00014}\mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session}{00014}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session}{AuthenticateSession}}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00015}00015\ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00021}\mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_a20d7415a9c3391b32d7fe2136fce6e2c}{00021}}\ \ \ \ \ \textcolor{keyword}{protected}\ \mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_a20d7415a9c3391b32d7fe2136fce6e2c}{\$auth}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00029}\mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_a990122167f98166eff6ab1e1253ae069}{00029}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ \mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_a990122167f98166eff6ab1e1253ae069}{\_\_construct}}(AuthFactory\ \mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_a20d7415a9c3391b32d7fe2136fce6e2c}{\$auth}})}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00030}00030\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00031}00031\ \ \ \ \ \ \ \ \ \$this-\/>auth\ =\ \mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_a20d7415a9c3391b32d7fe2136fce6e2c}{\$auth}};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00032}00032\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00041}\mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_abc042d95f5786d8adcdee22a40a727bd}{00041}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ \mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_abc042d95f5786d8adcdee22a40a727bd}{handle}}(\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request}{Request}}\ \$request,\ Closure\ \$next):\ \mbox{\hyperlink{class_symfony_1_1_component_1_1_http_foundation_1_1_response}{Response}}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00042}00042\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00043}00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\ \$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a1fd20747cf9cd10009df22748e08db6b}{hasSession}}()\ ||\ !\ \$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a8e3df2efcb568bc08212c825de559dc5}{user}}())\ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00044}00044\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$next(\$request);}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00045}00045\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00046}00046\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00047}00047\ \ \ \ \ \ \ \ \ \$guards\ =\ Collection::make(Arr::wrap(config(\textcolor{stringliteral}{'sanctum.guard'})))}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00048}00048\ \ \ \ \ \ \ \ \ \ \ \ \ -\/>mapWithKeys(fn\ (\$guard)\ =>\ [\$guard\ =>\ \$this-\/>auth-\/>guard(\$guard)])}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00049}00049\ \ \ \ \ \ \ \ \ \ \ \ \ -\/>filter(fn\ (\$guard)\ =>\ \$guard\ instanceof\ \mbox{\hyperlink{class_illuminate_1_1_auth_1_1_session_guard}{SessionGuard}});}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00051}00051\ \ \ \ \ \ \ \ \ \$shouldLogout\ =\ \$guards-\/>filter(}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ fn\ (\$guard,\ \$driver)\ =>\ \$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a912187b9bad05f8454864cc5eef14395}{session}}()-\/>has(\textcolor{stringliteral}{'password\_hash\_'}.\$driver)}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00053}00053\ \ \ \ \ \ \ \ \ )-\/>filter(}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ fn\ (\$guard,\ \$driver)\ =>\ \$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a912187b9bad05f8454864cc5eef14395}{session}}()-\/>get(\textcolor{stringliteral}{'password\_hash\_'}.\$driver)\ !==}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a8e3df2efcb568bc08212c825de559dc5}{user}}()-\/>getAuthPassword()}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00056}00056\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00057}00057\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\$shouldLogout-\/>isNotEmpty())\ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ \$shouldLogout-\/>each-\/>logoutCurrentDevice();}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a912187b9bad05f8454864cc5eef14395}{session}}()-\/>flush();}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00062}00062\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{class_illuminate_1_1_auth_1_1_authentication_exception}{AuthenticationException}}(\textcolor{stringliteral}{'Unauthenticated.'},\ [...\$shouldLogout-\/>keys()-\/>all(),\ \textcolor{stringliteral}{'sanctum'}]);}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00064}00064\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00066}00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ tap(\$next(\$request),\ \textcolor{keyword}{function}\ ()\ use\ (\$request,\ \$guards)\ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\ is\_null(\$request-\/>\mbox{\hyperlink{class_illuminate_1_1_http_1_1_request_a8e3df2efcb568bc08212c825de559dc5}{user}}()))\ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \$this-\/>storePasswordHashInSession(\$request,\ \$guards-\/>keys()-\/>first());}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00070}00070\ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00071}00071\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00080}\mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_af664fdbf5d878067954ebed140ebe86f}{00080}}\ \ \ \ \ \textcolor{keyword}{protected}\ \textcolor{keyword}{function}\ \mbox{\hyperlink{class_laravel_1_1_sanctum_1_1_http_1_1_middleware_1_1_authenticate_session_af664fdbf5d878067954ebed140ebe86f}{storePasswordHashInSession}}(\$request,\ \textcolor{keywordtype}{string}\ \$guard)}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00081}00081\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00082}00082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\ \$request-\/>user())\ \{}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00084}00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00086}00086\ \ \ \ \ \ \ \ \ \$request-\/>session()-\/>put([}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}password\_hash\_\{\$guard\}"{}}\ =>\ \$request-\/>user()-\/>getAuthPassword(),}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00088}00088\ \ \ \ \ \ \ \ \ ]);}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00089}00089\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{sanctum_2src_2_http_2_middleware_2_authenticate_session_8php_source_l00090}00090\ \}}

\end{DoxyCode}
