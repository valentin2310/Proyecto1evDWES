\chapter{A better PHP backtrace}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e}{}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e}\index{A better PHP backtrace@{A better PHP backtrace}}
\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2080}%
\Hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2080}%
 \href{https://packagist.org/packages/spatie/backtrace}{\texttt{ }}  \href{https://packagist.org/packages/spatie/backtrace}{\texttt{ }}

To get the backtrace in PHP you can use the {\ttfamily debug\+\_\+backtrace} function. By default, it can be hard to work with. The reported function name for a frame is skewed\+: it belongs to the previous frame. Also, options need to be passed using a bitmask.

This package provides a better way than {\ttfamily debug\+\_\+backtrace} to work with a back trace. Here\textquotesingle{}s an example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ returns\ an\ array\ with\ \`{}Spatie\(\backslash\)Backtrace\(\backslash\)Frame`\ instances}}
\DoxyCodeLine{\$frames\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()-\/>frames();\ }
\DoxyCodeLine{}
\DoxyCodeLine{\$firstFrame\ =\ \$frames[0];}
\DoxyCodeLine{}
\DoxyCodeLine{\$firstFrame-\/>file;\ \textcolor{comment}{//\ returns\ the\ file\ name}}
\DoxyCodeLine{\$firstFrame-\/>lineNumber;\ \textcolor{comment}{//\ returns\ the\ line\ number}}
\DoxyCodeLine{\$firstFrame-\/>class;\ \textcolor{comment}{//\ returns\ the\ class\ name}}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2081}{}\doxysection{\texorpdfstring{Support us}{Support us}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2081}
\href{https://spatie.be/github-ad-click/backtrace}{\texttt{ \texorpdfstring{$<$}{<}img src="{}https\+://github-\/ads.\+s3.\+eu-\/central-\/1.\+amazonaws.\+com/backtrace.\+jpg?t=1"{} width="{}419px"{} /\texorpdfstring{$>$}{>}}}

We invest a lot of resources into creating \href{https://spatie.be/open-source}{\texttt{ best in class open source packages}}. You can support us by \href{https://spatie.be/open-source/support-us}{\texttt{ buying one of our paid products}}.

We highly appreciate you sending us a postcard from your hometown, mentioning which of our package(s) you are using. You\textquotesingle{}ll find our address on \href{https://spatie.be/about-us}{\texttt{ our contact page}}. We publish all received postcards on \href{https://spatie.be/open-source/postcards}{\texttt{ our virtual postcard wall}}.\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2082}{}\doxysection{\texorpdfstring{Installation}{Installation}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2082}
You can install the package via composer\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{composer\ require\ spatie/backtrace}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2083}{}\doxysection{\texorpdfstring{Usage}{Usage}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2083}
This is how you can create a backtrace instance\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$backtrace\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create();}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2084}{}\doxysubsection{\texorpdfstring{Getting the frames}{Getting the frames}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2084}
To get all the frames you can call {\ttfamily frames}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$frames\ =\ \$backtrace-\/>frames();\ \textcolor{comment}{//\ contains\ an\ array\ with\ \`{}Spatie\(\backslash\)Backtrace\(\backslash\)Frame`\ instances}}

\end{DoxyCode}


A {\ttfamily Spatie\textbackslash{}Backtrace\textbackslash{}Frame} has these properties\+:


\begin{DoxyItemize}
\item {\ttfamily file}\+: the name of the file
\item {\ttfamily line\+Number}\+: the line number
\item {\ttfamily arguments}\+: the arguments used for this frame. Will be {\ttfamily null} if {\ttfamily with\+Arguments} was not used.
\item {\ttfamily class}\+: the class name for this frame. Will be {\ttfamily null} if the frame concerns a function.
\item {\ttfamily method}\+: the method used in this frame
\item {\ttfamily application\+Frame}\+: contains {\ttfamily true} is this frame belongs to your application, and {\ttfamily false} if it belongs to a file in the vendor directory
\end{DoxyItemize}\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2085}{}\doxysubsection{\texorpdfstring{Collecting arguments}{Collecting arguments}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2085}
For performance reasons, the frames of the back trace will not contain the arguments of the called functions. If you want to add those use the {\ttfamily with\+Arguments} method.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$backtrace\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()-\/>withArguments();}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2086}{}\doxysubsubsection{\texorpdfstring{Reducing arguments}{Reducing arguments}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2086}
For viewing purposes, arguments can be reduced to a string\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$backtrace\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()-\/>withArguments()-\/>reduceArguments();}

\end{DoxyCode}


By default, some typical types will be reduced to a string. You can define your own reduction algorithm per type by implementing an {\ttfamily Argument\+Reducer}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{class\ }DateTimeWithOtherFormatArgumentReducer\ \textcolor{keyword}{implements}\ ArgumentReducer}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{function}\ \mbox{\hyperlink{namespace_illuminate_1_1_testing_1_1_concerns_a1909f4b7f8129c7790cb75de2ffbe1e4}{execute}}(\$argument):\ ReducedArgumentContract}
\DoxyCodeLine{\ \ \ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\ \$argument\ instanceof\ DateTimeInterface)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ UnReducedArgument::create();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ ReducedArgument(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \$argument-\/>format(\textcolor{stringliteral}{'d/m/y\ H:i'}),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ get\_class(\$argument),}
\DoxyCodeLine{\ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


This is a copy of the built-\/in argument reducer for {\ttfamily Date\+Time\+Interface} where we\textquotesingle{}ve updated the format. An {\ttfamily Un\+Reduced\+Argument} object is returned when the argument is not of the expected type. A {\ttfamily Reduced\+Argument} object is returned with the reduced value of the argument and the original type of the argument.

The reducer can be used as such\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$backtrace\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()-\/>withArguments()-\/>reduceArguments(}
\DoxyCodeLine{\ \ \ \ Spatie\(\backslash\)Backtrace\(\backslash\)Arguments\(\backslash\)ArgumentReducers::default([}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ DateTimeWithOtherFormatArgumentReducer()}
\DoxyCodeLine{\ \ \ \ ])}
\DoxyCodeLine{);}

\end{DoxyCode}


Which will first execute the new reducer and then the default ones.\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2087}{}\doxysubsection{\texorpdfstring{Setting the application path}{Setting the application path}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2087}
You can use the {\ttfamily application\+Path} to pass the base path of your app. This value will be used to determine whether a frame is an application frame, or a vendor frame. Here\textquotesingle{}s an example using a Laravel specific function.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$backtrace\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()-\/>applicationPath(base\_path());}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2088}{}\doxysubsection{\texorpdfstring{Getting a certain part of a trace}{Getting a certain part of a trace}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2088}
If you only want to have the frames starting from a particular frame in the backtrace you can use the {\ttfamily starting\+From\+Frame} method\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_spatie_1_1_backtrace_1_1_backtrace}{Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace}};}
\DoxyCodeLine{use\ \mbox{\hyperlink{class_spatie_1_1_backtrace_1_1_frame}{Spatie\(\backslash\)Backtrace\(\backslash\)Frame}};}
\DoxyCodeLine{}
\DoxyCodeLine{\$frames\ =\ Backtrace::create()}
\DoxyCodeLine{\ \ \ \ -\/>startingFromFrame(\textcolor{keyword}{function}\ (Frame\ \$frame)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \$frame-\/>class\ ===\ MyClass::class;}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \ \ -\/>frames();}

\end{DoxyCode}


With this code, all frames before the frame that concerns {\ttfamily My\+Class} will have been filtered out.

Alternatively, you can use the {\ttfamily offset} method, which will skip the given number of frames. In this example the first 2 frames will not end up in {\ttfamily \$frames}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$frames\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()}
\DoxyCodeLine{\ \ \ \ -\/>offset(2)}
\DoxyCodeLine{\ \ \ \ -\/>frames();}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2089}{}\doxysubsection{\texorpdfstring{Limiting the number of frames}{Limiting the number of frames}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2089}
To only get a specific number of frames use the {\ttfamily limit} function. In this example, we\textquotesingle{}ll only get the first two frames.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$frames\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::create()}
\DoxyCodeLine{\ \ \ \ -\/>limit(2)}
\DoxyCodeLine{\ \ \ \ -\/>frames();}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2090}{}\doxysubsection{\texorpdfstring{Getting a backtrace for a throwable}{Getting a backtrace for a throwable}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2090}
Here\textquotesingle{}s how you can get a backtrace for a throwable.


\begin{DoxyCode}{0}
\DoxyCodeLine{\$frames\ =\ Spatie\(\backslash\)Backtrace\(\backslash\)Backtrace::createForThrowable(\$throwable)}

\end{DoxyCode}


Because we will use the backtrace that is already available the throwable, the frames will always contain the arguments used.\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2091}{}\doxysection{\texorpdfstring{Testing}{Testing}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2091}

\begin{DoxyCode}{0}
\DoxyCodeLine{\ bash}
\DoxyCodeLine{composer\ test}

\end{DoxyCode}
\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2092}{}\doxysection{\texorpdfstring{Changelog}{Changelog}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2092}
Please see \doxylink{webmozart_2assert_2_c_h_a_n_g_e_l_o_g_8md}{CHANGELOG} for more information on what has changed recently.\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2093}{}\doxysection{\texorpdfstring{Contributing}{Contributing}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2093}
Please see \href{https://github.com/spatie/.github/blob/main/CONTRIBUTING.md}{\texttt{ CONTRIBUTING}} for details.\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2094}{}\doxysection{\texorpdfstring{Security Vulnerabilities}{Security Vulnerabilities}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2094}
Please review \href{../../security/policy}{\texttt{ our security policy}} on how to report security vulnerabilities.\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2095}{}\doxysection{\texorpdfstring{Credits}{Credits}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2095}

\begin{DoxyItemize}
\item \href{https://github.com/freekmurze}{\texttt{ Freek Van de Herten}}
\item \href{../../contributors}{\texttt{ All Contributors}}
\end{DoxyItemize}\hypertarget{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2096}{}\doxysection{\texorpdfstring{License}{License}}\label{md_vendor_2spatie_2backtrace_2_r_e_a_d_m_e_autotoc_md2096}
The MIT License (MIT). Please see \doxysectlink{md_vendor_2spatie_2backtrace_2_l_i_c_e_n_s_e}{License File}{0} for more information. 