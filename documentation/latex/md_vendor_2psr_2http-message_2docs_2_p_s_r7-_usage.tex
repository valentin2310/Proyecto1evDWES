\chapter{PSR-\/7 Usage}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage}{}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage}\index{PSR-\/7 Usage@{PSR-\/7 Usage}}
\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1582}%
\Hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1582}%
 All PSR-\/7 applications comply with these interfaces They were created to establish a standard between middleware implementations.

\begin{quote}
{\ttfamily Request\+Interface}, {\ttfamily Server\+Request\+Interface}, {\ttfamily Response\+Interface} extend {\ttfamily Message\+Interface} because the {\ttfamily Request} and the {\ttfamily Response} are {\ttfamily HTTP Messages}. When using {\ttfamily Server\+Request\+Interface}, both {\ttfamily Request\+Interface} and {\ttfamily Psr\textbackslash{}Http\textbackslash{}Message\textbackslash{}Message\+Interface} methods are considered. \end{quote}


The following examples will illustrate how basic operations are done in PSR-\/7.\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1583}{}\doxyparagraph{\texorpdfstring{Examples}{Examples}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1583}
For this examples to work (at least) a PSR-\/7 implementation package is required. (eg\+: zendframework/zend-\/diactoros, guzzlehttp/psr7, slim/slim, etc) All PSR-\/7 implementations should have the same behaviour.

The following will be assumed\+: {\ttfamily \$request} is an object of {\ttfamily Psr\textbackslash{}Http\textbackslash{}Message\textbackslash{}Request\+Interface} and

{\ttfamily \$response} is an object implementing {\ttfamily Psr\textbackslash{}Http\textbackslash{}Message\textbackslash{}Request\+Interface}\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1584}{}\doxysubsection{\texorpdfstring{Working with HTTP Headers}{Working with HTTP Headers}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1584}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1585}{}\doxysubsubsection{\texorpdfstring{Adding headers to response\+:}{Adding headers to response:}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1585}

\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>withHeader(\textcolor{stringliteral}{'My-\/Custom-\/Header'},\ \textcolor{stringliteral}{'My\ Custom\ Message'});}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1586}{}\doxysubsubsection{\texorpdfstring{Appending values to headers}{Appending values to headers}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1586}

\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>withAddedHeader(\textcolor{stringliteral}{'My-\/Custom-\/Header'},\ \textcolor{stringliteral}{'The\ second\ message'});}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1587}{}\doxysubsubsection{\texorpdfstring{Checking if header exists\+:}{Checking if header exists:}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1587}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$request-\/>hasHeader(\textcolor{stringliteral}{'My-\/Custom-\/Header'});\ \textcolor{comment}{//\ will\ return\ false}}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>hasHeader(\textcolor{stringliteral}{'My-\/Custom-\/Header'});\ \textcolor{comment}{//\ will\ return\ true}}

\end{DoxyCode}


\begin{quote}
Note\+: My-\/\+Custom-\/\+Header was only added in the Response \end{quote}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1588}{}\doxysubsubsection{\texorpdfstring{Getting comma-\/separated values from a header (also applies to request)}{Getting comma-separated values from a header (also applies to request)}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1588}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ getting\ value\ from\ request\ headers}}
\DoxyCodeLine{\$request-\/>getHeaderLine(\textcolor{stringliteral}{'Content-\/Type'});\ \textcolor{comment}{//\ will\ return:\ "{}text/html;\ charset=UTF-\/8"{}}}
\DoxyCodeLine{\textcolor{comment}{//\ getting\ value\ from\ response\ headers}}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getHeaderLine(\textcolor{stringliteral}{'My-\/Custom-\/Header'});\ \textcolor{comment}{//\ will\ return:\ \ "{}My\ Custom\ Message;\ The\ second\ message"{}}}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1589}{}\doxysubsubsection{\texorpdfstring{Getting array of value from a header (also applies to request)}{Getting array of value from a header (also applies to request)}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1589}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ getting\ value\ from\ request\ headers}}
\DoxyCodeLine{\$request-\/>getHeader(\textcolor{stringliteral}{'Content-\/Type'});\ \textcolor{comment}{//\ will\ return:\ ["{}text/html"{},\ "{}charset=UTF-\/8"{}]}}
\DoxyCodeLine{\textcolor{comment}{//\ getting\ value\ from\ response\ headers}}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getHeader(\textcolor{stringliteral}{'My-\/Custom-\/Header'});\ \textcolor{comment}{//\ will\ return:\ \ ["{}My\ Custom\ Message"{},\ \ "{}The\ second\ message"{}]}}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1590}{}\doxysubsubsection{\texorpdfstring{Removing headers from HTTP Messages}{Removing headers from HTTP Messages}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1590}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ removing\ a\ header\ from\ Request,\ removing\ deprecated\ "{}Content-\/MD5"{}\ header}}
\DoxyCodeLine{\$request-\/>withoutHeader(\textcolor{stringliteral}{'Content-\/MD5'});\ }
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ removing\ a\ header\ from\ Response}}
\DoxyCodeLine{\textcolor{comment}{//\ effect:\ the\ browser\ won't\ know\ the\ size\ of\ the\ stream}}
\DoxyCodeLine{\textcolor{comment}{//\ the\ browser\ will\ download\ the\ stream\ till\ it\ ends}}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>withoutHeader(\textcolor{stringliteral}{'Content-\/Length'});}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1591}{}\doxysubsection{\texorpdfstring{Working with HTTP Message Body}{Working with HTTP Message Body}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1591}
When working with the PSR-\/7 there are two methods of implementation\+: \hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1592}{}\doxysubsubsection{\texorpdfstring{1. Getting the body separately}{1. Getting the body separately}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1592}
\begin{quote}
This method makes the body handling easier to understand and is useful when repeatedly calling body methods. (You only call {\ttfamily get\+Body()} once). Using this method mistakes like {\ttfamily \$response-\/\texorpdfstring{$>$}{>}write()} are also prevented. \end{quote}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$body\ =\ \mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getBody();}
\DoxyCodeLine{\textcolor{comment}{//\ operations\ on\ body,\ eg.\ read,\ write,\ seek}}
\DoxyCodeLine{\textcolor{comment}{//\ ...}}
\DoxyCodeLine{\textcolor{comment}{//\ replacing\ the\ old\ body}}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>withBody(\$body);\ }
\DoxyCodeLine{\textcolor{comment}{//\ this\ last\ statement\ is\ optional\ as\ we\ working\ with\ objects}}
\DoxyCodeLine{\textcolor{comment}{//\ in\ this\ case\ the\ "{}new"{}\ body\ is\ same\ with\ the\ "{}old"{}\ one}}
\DoxyCodeLine{\textcolor{comment}{//\ the\ \$body\ variable\ has\ the\ same\ value\ as\ the\ one\ in\ \$request,\ only\ the\ reference\ is\ passed}}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1593}{}\doxysubsubsection{\texorpdfstring{2. Working directly on response}{2. Working directly on response}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1593}
\begin{quote}
This method is useful when only performing few operations as the {\ttfamily \$request-\/\texorpdfstring{$>$}{>}get\+Body()} statement fragment is required \end{quote}

\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getBody()-\/>write(\textcolor{stringliteral}{'hello'});}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1594}{}\doxysubsection{\texorpdfstring{Getting the body contents}{Getting the body contents}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1594}
The following snippet gets the contents of a stream contents. \begin{quote}
Note\+: Streams must be rewinded, if content was written into streams, it will be ignored when calling {\ttfamily get\+Contents()} because the stream pointer is set to the last character, which is {\ttfamily \textbackslash{}0} -\/ meaning end of stream. \end{quote}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$body\ =\ \mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getBody();}
\DoxyCodeLine{\$body-\/>rewind();\ \textcolor{comment}{//\ or\ \$body-\/>seek(0);}}
\DoxyCodeLine{\$bodyText\ =\ \$body-\/>getContents();}

\end{DoxyCode}
 ~\newline
 \begin{quote}
Note\+: If {\ttfamily \$body-\/\texorpdfstring{$>$}{>}seek(1)} is called before {\ttfamily \$body-\/\texorpdfstring{$>$}{>}get\+Contents()}, the first character will be ommited as the starting pointer is set to {\ttfamily 1}, not {\ttfamily 0}. This is why using {\ttfamily \$body-\/\texorpdfstring{$>$}{>}rewind()} is recommended. \end{quote}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1595}{}\doxysubsection{\texorpdfstring{Append to body}{Append to body}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1595}

\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getBody()-\/>write(\textcolor{stringliteral}{'Hello'});\ \textcolor{comment}{//\ writing\ directly}}
\DoxyCodeLine{\$body\ =\ \$request-\/>getBody();\ \textcolor{comment}{//\ which\ is\ a\ \`{}StreamInterface`}}
\DoxyCodeLine{\$body-\/>write(\textcolor{stringliteral}{'xxxxx'});}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1596}{}\doxysubsection{\texorpdfstring{Prepend to body}{Prepend to body}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1596}
Prepending is different when it comes to streams. The content must be copied before writing the content to be prepended. The following example will explain the behaviour of streams.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ assuming\ our\ response\ is\ initially\ empty}}
\DoxyCodeLine{\$body\ =\ \$repsonse-\/>getBody();}
\DoxyCodeLine{\textcolor{comment}{//\ writing\ the\ string\ "{}abcd"{}}}
\DoxyCodeLine{\$body-\/>write(\textcolor{stringliteral}{'abcd'});}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ seeking\ to\ start\ of\ stream}}
\DoxyCodeLine{\$body-\/>seek(0);}
\DoxyCodeLine{\textcolor{comment}{//\ writing\ 'ef'}}
\DoxyCodeLine{\$body-\/>write(\textcolor{stringliteral}{'ef'});\ \textcolor{comment}{//\ at\ this\ point\ the\ stream\ contains\ "{}efcd"{}}}

\end{DoxyCode}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1597}{}\doxysubsubsection{\texorpdfstring{Prepending by rewriting separately}{Prepending by rewriting separately}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1597}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{//\ assuming\ our\ response\ body\ stream\ only\ contains:\ "{}abcd"{}}}
\DoxyCodeLine{\$body\ =\ \mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getBody();}
\DoxyCodeLine{\$body-\/>rewind();}
\DoxyCodeLine{\$contents\ =\ \$body-\/>getContents();\ \textcolor{comment}{//\ abcd}}
\DoxyCodeLine{\textcolor{comment}{//\ seeking\ the\ stream\ to\ beginning}}
\DoxyCodeLine{\$body-\/>rewind();}
\DoxyCodeLine{\$body-\/>write(\textcolor{stringliteral}{'ef'});\ \textcolor{comment}{//\ stream\ contains\ "{}efcd"{}}}
\DoxyCodeLine{\$body-\/>write(\$contents);\ \textcolor{comment}{//\ stream\ contains\ "{}efabcd"{}}}

\end{DoxyCode}


\begin{quote}
Note\+: {\ttfamily get\+Contents()} seeks the stream while reading it, therefore if the second {\ttfamily rewind()} method call was not present the stream would have resulted in {\ttfamily abcdefabcd} because the {\ttfamily write()} method appends to stream if not preceeded by {\ttfamily rewind()} or {\ttfamily seek(0)}. \end{quote}
\hypertarget{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1598}{}\doxysubsubsection{\texorpdfstring{Prepending by using contents as a string}{Prepending by using contents as a string}}\label{md_vendor_2psr_2http-message_2docs_2_p_s_r7-_usage_autotoc_md1598}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$body\ =\ \mbox{\hyperlink{index_8php_af4b6fb1bbc77ccc05f10da3b16935b99}{\$response}}-\/>getBody();}
\DoxyCodeLine{\$body-\/>rewind();}
\DoxyCodeLine{\$contents\ =\ \$body-\/>getContents();\ \textcolor{comment}{//\ efabcd}}
\DoxyCodeLine{\$contents\ =\ \textcolor{stringliteral}{'ef'}.\$contents;}
\DoxyCodeLine{\$body-\/>rewind();}
\DoxyCodeLine{\$body-\/>write(\$contents);}

\end{DoxyCode}
 